<!DOCTYPE html>
<html lang="en">
<head>
<title>Nabel Yahoo app</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<!-- ocpu library -->
<script src="opencpu/jquery-1.10.2.min.js"> </script>
<script src="q.js"> </script>
<script src= "opencpu/opencpu-0.4.js"> </script>
<script src= "react/build/react.js"> </script>
<script src= "react/build/react-dom.js"> </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>

<!-- some optional styling stuff -->
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="jqueryui/css/ui-lightness/jquery-ui-1.10.3.custom.css" rel="stylesheet" media="screen">

<script src="bootstrap/js/bootstrap.js"> </script>
<script src="jqueryui/jquery-ui-1.10.3.custom.js"> </script>


<body>
  
<script type="text/babel">
            
  var HelloWorld = React.createClass({
      getInitialState: function() {
          return {
              console: "still busy....",
              url : "/ocpu/library/mortality/R/",
              posturl: "",
              parameters: ""
          };
      },
      componentDidMount: function() {
       this.getInfo();
    },
    handleChange: function(event) {
    this.setState({url: event.target.value});
    },

    handleChange2: function(event){
      this.setState({parameters:event.target.value})
    },
    getInfo:function(){
       $.ajax({ url:this.state.url,data:"text"}).done(function(res,text, jqxhr){
          this.setState({console:res});
       }.bind(this));
    },
    postInfo:function(){
      alert(this.state.parameters)
      var data = {}
      data = this.state.parameters //{'numSims':10,'progYears':10}
      var obj = jQuery.parseJSON(data);
      alert(obj.progYears);
       $.ajax({ url:this.state.url,
               data: JSON.stringify(obj),
               dataType:"json",
               type:"post",
               contentType : "application/json"})
              .done(function(res,text, jqxhr){
                  alert("done");
                  this.setState({console:res});
                  alert(jqxhr.Location);
                  alert("Hello");
              }).bind(this);
       alert(this.state.url+ "/" + data)
    },
      render: function() {
          return (
              <div>
                <pre> {this.state.console} </pre>
                <b> Get </b> <br />
                <input value = {this.state.url} onChange = {this.handleChange} /> <br/>
                <button onClick = {this.getInfo} > get </button> <br/>    
                
                <b> Post </b>
                
                <input value = {this.state.parameters} onChange = {this.handleChange2} />
                <button onClick = {this.postInfo}> "Post Info" </button>  <br/>
                
              </div>  
              
          );    
      }
  });
          ReactDOM.render(
            <HelloWorld url = "/ocpu/library/mortality/R/" />,
            document.getElementById('content')
          );

</script>
      
<div id = "content">
  
</div>  
    
</body>
</html>
